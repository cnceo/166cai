$(function(){function w(){1==selling&&(0==r||1==hmselling&&1E3*hmendTime>=(new Date).valueOf())?$("[id^\x3dpd][id$\x3d_buy]").removeClass("btn-disabled").addClass("needTigger submit").html("\u786e\u8ba4\u9884\u7ea6"):$("[id^\x3dpd][id$\x3d_buy]").removeClass("needTigger submit").addClass("btn-disabled").html("\u6682\u505c\u9884\u7ea6");$("body").find("#buy_tip").remove()}Array.prototype.filter||(Array.prototype.filter=function(a,b){if(void 0===this||null===this)throw new TypeError;var c=Object(this),m=c.length>>>0;if("function"!==typeof a)throw new TypeError;for(var e=[],d=0;d<m;d++)if(d in c){var f=c[d];a.call(b,f,d,c)&&e.push(f)}return e});Array.prototype.reduce||(Array.prototype.reduce=function(a){var b=this.length;if("function"!=typeof a)throw new TypeError;if(0==b&&1==arguments.length)throw new TypeError;var c=0;if(2<=arguments.length)var m=arguments[1];else{do{if(c in this){m=this[c++];break}if(++c>=b)throw new TypeError;}while(1)}for(;c<b;c++)c in this&&(m=a.call(null,m,this[c],c,this));return m});var t="sfc"==typeEnName?14:9,p=0,f=0,x=0,B=0,n=!1,q=!1,y,e=0,h=0,u=5,r=0,C=0,z=0,D={0:"#",1:"0",2:"1",3:"10",4:"3",5:"30",6:"31",7:"310"},E={0:"-",1:"0",2:"1",3:"10",4:"3",5:"30",6:"31",7:"310"},F={0:1,1:1,2:1,3:2,4:1,5:2,6:2,7:3},g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0],G=$(".bet-num, .betNum"),H=$(".bet-money, .betMoney"),I=$(".current-bet-num"),J=$(".current-bet-money"),v=new cx.AdderSubtractor(".multi-modifier"),K=$("#end-time").data("time"),d=function(){var a={},b={};a.add=function(a,m){return b[a]=m};a.isComplete=function(a){return a.filter(function(a){return 0<a}).length>=t};a.calcBet=function(a){return $.map(cx.Math.slowCombineList(a.filter(function(a){return 0<a}),t),function(a){return $.map(a,function(a){return F[a]}).reduce(function(a,b){return a*b})}).reduce(function(a,b){return a+b})};a.remove=function(a){a in b&&delete b[a]};a.count=function(){var a=0;$.each(b,function(){a+=1});return a};a.maxIndex=function(){var a=0;$.each(b,function(b){b>a&&(a=parseInt(b,10))});return a};a.get=function(a){return b[a]||{}};a.getAll=function(){return b};a.getArray=function(){var a=[];$.each(b,function(b,c){a.push(c)});return a};a.initCurrent=function(){g=$.map(g,function(){return 0})};a.empty=function(){return b={}};return a}(),l=function(){return{show:function(){$(".cast-list").html(function(){return $.map($.map(d.getAll(),function(a,b){return b}).reverse(),function(a){var b=d.get(a);return['\x3cli data-index\x3d"',a,'"',q&&y&&a==y?' class\x3d"hover" ':"",'\x3e\x3cdiv class\x3d"num-group"\x3e',$.map(b,function(a){return["\x3cspan\x3e",E[a],"\x3c/span\x3e"].join("")}).join(" "),'\x3c/div\x3e\x3ca href\x3d"javascript:;" class\x3d"delete-line"\x3e\u5220\u9664\x3c/a\x3e','\x3ca href\x3d"javascript:;" class\x3d"modify-line"\x3e\u4fee\u6539\x3c/a\x3e\x3cspan class\x3d"bet-money"\x3e',2*d.calcBet(b),"\u5143\x3c/span\x3e\x3c/li\x3e"]}).join("")})},checkBox:function(){$(".select-all").each(function(){var a=$(this),b=!0;a.closest(".match").find(".options").each(function(){if(!$(this).hasClass("selected"))return b=!1});b?a.prop("checked",!0):a.prop("checked",!1)})}}}(),k=function(){a=function(){var a=this;$(".commission").on("click","li",function(){console.log(1);$(".commission li").removeClass("cur");$(this).addClass("cur");z=$(this).data("val");u=5>=z?5:z;buyMoneyTmp=Math.ceil(f*u/100);e=buyMoneyTmp>e?buyMoneyTmp:e;if($(".guaranteeAll").attr("checked")||h>f-e)h=f-e,$(".guaranteeAll").attr("checked","checked"),a.renderGuarantee();a.renderBuyMoney()});$(".buyMoney").on("blur","input",function(){e=isNaN(parseInt($(this).val(),10))?0:parseInt($(this).val(),10);buyMoneymin=Math.ceil(f*u/100);e=e<buyMoneymin?buyMoneymin:e>f?f:e;if($(".guaranteeAll").attr("checked")||h>f-e)h=f-e,$(".guaranteeAll").attr("checked","checked"),a.renderGuarantee();a.renderBuyMoney()});$(".guarantee").on("blur","input.form-item-ipt",function(){h=isNaN(parseInt($(this).val(),10))?0:parseInt($(this).val(),10);$(".guaranteeAll").removeAttr("checked");h>=f-e&&(h=f-e,$(".guaranteeAll").attr("checked","checked"));h=0>h?0:h;a.renderGuarantee()});$(".guaranteeAll").on("click",function(){h=f-e;a.renderGuarantee()});$("input[name\x3dbmsz]").click(function(){C=$(this).val()})};a.prototype={renderBuyMoney:function(){$(".buyMoney input").val(e).parents(".buyMoney").find("span em:first").html(u);0<e?$(".buyMoney").find("u").show().find("em").html(Math.floor(100*e/f)):$(".buyMoney").find("u").hide();$(".guarantee span em:first").html(f-e);$(".buy_txt").html("\x3cem class\x3d'main-color-s'\x3e"+(e+h)+"\x3c/em\x3e \u5143 \x3cspan\x3e\uff08\u8ba4\u8d2d"+e+"\u5143+\u4fdd\u5e95"+h+"\u5143\uff09\x3c/span\x3e\x3c/span\x3e")},renderGuarantee:function(){$(".guarantee input.form-item-ipt").val(h).parents(".guarantee").find("span em:last").html(0==f?0:Math.floor(100*h/f));$(".buy_txt").html("\x3cem class\x3d'main-color-s'\x3e"+(e+h)+"\x3c/em\x3e \u5143 \x3cspan\x3e\uff08\u8ba4\u8d2d"+e+"\u5143+\u4fdd\u5e95"+h+"\u5143\uff09\x3c/span\x3e\x3c/span\x3e")}};var a=new a;return{renderBet:function(){p=d.count()?$.map(d.getArray(),function(a){return d.calcBet(a)}).reduce(function(a,c){return a+c}):0;n||(p=x);f=2*p*v.getValue();buyMoneymin=Math.ceil(f*u/100);e=e<buyMoneymin?buyMoneymin:e>f?f:e;G.html(p);H.html(f);if($(".guaranteeAll").attr("checked")||h>f-e)h=f-e,$(".guaranteeAll").attr("checked","checked");a.renderGuarantee();a.renderBuyMoney()},renderCurrentBet:function(){x=d.isComplete(g)?d.calcBet(g):0;B=2*x;I.html(x);J.html(B)},getCastOptions:function(){var a=n?d.getArray():[g],a=$.map(a,function(a){return[$.map(a,function(a){return D[a]}).join(","),"1:1"].join(":")}).join(";");return 4==r?{ctype:"create",buyPlatform:0,codes:a,lid:lotteryId,money:f,multi:v.getValue(),issue:currIssue,playType:0,betTnum:p,isChase:0,orderType:4,endTime:hmDate.getFullYear()+"-"+padd(hmDate.getMonth()+1)+"-"+padd(hmDate.getDate())+" "+padd(hmDate.getHours())+":"+padd(hmDate.getMinutes())+":"+padd(hmDate.getSeconds()),codecc:"1 2 3 4 5 6 7 8 9 10 11 12 13 14",isToken:1,buyMoney:e,commissionRate:z,guaranteeAmount:h,openStatus:C,openEndtime:realendTime}:{ctype:"create",buyPlatform:0,codes:a,lid:lotteryId,money:f,multi:v.getValue(),issue:currIssue,playType:0,betTnum:p,isChase:0,orderType:0,endTime:K,codecc:"1 2 3 4 5 6 7 8 9 10 11 12 13 14",isToken:1}}}}(),A;v.setCb(function(){$(".Multi").html(this.value);k.renderCurrentBet();k.renderBet()});$(".table-option").on({mouseover:function(){$(this).addClass("table-option-hover")},mouseout:function(){$(this).removeClass("table-option-hover")}});$("body").on("click",".odds-refer",function(){var a=$(this),b=a.html();$.post("ajax/queryReferOdds",{lid:lotteryId,cid:a.data("cid"),issue:currIssue},function(c){a.closest(".table-option-list").find(".selected").removeClass("selected").end().end().addClass("selected");$(".match").each(function(){var a=$(this),b=a.data("index")+1;b in c||(c[b]={oh:"0.00",od:"0.00",oa:"0.00"});a.find(".pjop").children(".op-oh").html(parseFloat(c[b].oh).toFixed(2)).end().children(".op-od").html(parseFloat(c[b].od).toFixed(2)).end().children(".op-oa").html(parseFloat(c[b].oa).toFixed(2)).end()});$("#op-name").html(b+'\x3ci class\x3d"table-option-arrow"\x3e\x3c/i\x3e')},"json")}).on("click",".filterPeriods",function(){location.assign([location.origin,location.pathname,"?issue\x3d",$(this).data("issue")].join(""))}).on("click",".bet-type-more, .btn-hemai",function(){var a=$(this);n=!0;a.closest(".bet-type-danx").hide().nextAll(".bet-type-duox,.buy-type").show();d.isComplete(g)&&(a.closest(".bet-main").find(".options").removeClass("selected"),l.checkBox(),d.empty(),d.add(d.maxIndex()+1,$.map(g,function(a){return a})),d.initCurrent());l.show();v.render();k.renderCurrentBet();$(this).hasClass("btn-hemai")&&$("#ordertype1").trigger("click")}).on("click",".options",function(){var a=$(this),b=a.closest(".match").data("index"),c=a.data("val");a.hasClass("selected")?(g[b]-=c,a.removeClass("selected")):(g[b]+=c,a.addClass("selected"));l.checkBox();a=d.isComplete(g);n?($(".add-basket").toggleClass("btn-disabled",!a),$(".modify-confirm").toggleClass("btn-disabled",!a),k.renderCurrentBet()):(k.renderCurrentBet(),k.renderBet())}).on("click",".add-basket",function(){var a=$(this);if(!d.isComplete(g))return void new cx.Alert({content:"\u8bf7\u81f3\u5c11\u9009\u62e9"+t+"\u573a\u6bd4\u8d5b"});d.add(d.maxIndex()+1,$.map(g,function(a){return a}));d.initCurrent();a.removeClass("modify-confirm").addClass("add-basket btn-disabled").closest(".bet-main").find(".match").find(".options").removeClass("selected");l.checkBox();l.show();k.renderCurrentBet();k.renderBet()}).on("click",".modify-confirm",function(){var a=$(this),b=a.closest(".btn-pools").next(".bet-area").find(".cast-list").children(".hover").data("index")||y;if(!d.isComplete(g))return void new cx.Alert({content:"\u8bf7\u81f3\u5c11\u9009\u62e9"+t+"\u573a\u6bd4\u8d5b"});q=!1;d.add(b,$.map(g,function(a){return a}));d.initCurrent();a.removeClass("modify-confirm").addClass("add-basket btn-disabled").html('\u6dfb\u52a0\u5230\u6295\u6ce8\u533a\x3ci class\x3d"icon-font"\x3e\ue614\x3c/i\x3e').closest(".bet-main").find(".match").find(".options").removeClass("selected");l.checkBox();l.show();k.renderCurrentBet();k.renderBet()}).on("click",".rand-cast",function(){for(var a=$(this).data("volume"),b,c,e=0;e<a;e++)"sfc"==typeEnName?b=[]:(c=cx.Math.slowCombineList([0,1,2,3,4,5,6,7,8,10,11,12,13],5),b=c[Math.floor(Math.random()*c.length)]),c=$.map(g,function(a,c){return-1<$.inArray(c,b)?0:[1,2,4][Math.floor(3*Math.random())]}),d.add(d.maxIndex()+1,c);l.show();k.renderCurrentBet();k.renderBet()}).on("click",".modify-line",function(){var a=$(this).parent(),b=a.data("index"),c=$.map(d.get(b),function(a){return a});q=!0;y=b;$(".match").find(".options").removeClass("selected").end().each(function(){var a=$(this),b=a.data("index"),e=c[b];a.find(".options").each(function(){var a=$(this),b=a.data("val");if(e<b)return!0;e-=b;a.addClass("selected")})});l.checkBox();a.addClass("hover").siblings().removeClass("hover").end().closest(".bet-type-duox").find(".btn-add2bet").removeClass("add-basket btn-disabled").addClass("modify-confirm").html('\u786e\u8ba4\u4fee\u6539\x3ci class\x3d"icon-font"\x3e\ue614\x3c/i\x3e');g=$.map(c,function(a){return a});k.renderCurrentBet()}).on("click",".delete-line",function(){var a=$(this).parent(),b=a.data("index"),c=a.closest(".bet-type-duox").find(".btn-add2bet");d.remove(b);a.remove();q?a.hasClass("hover")&&c.removeClass("modify-confirm").addClass("add-basket").html('\u6dfb\u52a0\u5230\u6295\u6ce8\u533a\x3ci class\x3d"icon-font"\x3e\ue614\x3c/i\x3e'):($(".options").removeClass("selected"),d.initCurrent());l.checkBox();k.renderCurrentBet();k.renderBet()}).on("click",".clear-list",function(){var a=$(this).closest(".bet-type-duox").find(".btn-add2bet");$(".cast-list").empty();q&&(a.removeClass("modify-confirm").addClass("add-basket").html('\u6dfb\u52a0\u5230\u6295\u6ce8\u533a\x3ci class\x3d"icon-font"\x3e\ue614\x3c/i\x3e'),q=!1);d.empty();k.renderCurrentBet();k.renderBet()}).on("click",".select-all",function(){var a=$(this),b=a.closest(".match"),c=b.data("index"),b=b.find(".options");a.is(":checked")?(b.each(function(){$(this).addClass("selected")}),g[c]=7):(b.each(function(){$(this).removeClass("selected")}),g[c]=0);a=d.isComplete(g);n?($(".add-basket").toggleClass("btn-disabled",!a),$(".modify-confirm").toggleClass("btn-disabled",!a),k.renderCurrentBet()):(k.renderCurrentBet(),k.renderBet())}).find(".bet-main").on("click",".submit",function(){var a=$(this),b=a.closest(".btn-group").find(".agreement");if(a.hasClass("not-login")||!$.cookie("name_ie"))cx.PopAjax.login();else if(!a.hasClass("not-bind")){if(b.get(0)&&!b.is(":checked"))return void new cx.Alert({content:"\u8bf7\u9605\u8bfb\u5e76\u540c\u610f\u300a\u7528\u6237\u59d4\u6258\u6295\u6ce8\u534f\u8bae\u300b"});if(!n&&!d.isComplete(g)||n&&$.isEmptyObject(d.getAll()))return void new cx.Alert({content:"\u8bf7\u81f3\u5c11\u9009\u62e9"+t+"\u573a\u6bd4\u8d5b"});a=k.getCastOptions();2E5<a.money?new cx.Alert({content:["\x3ci class\x3d'icon-font'\x3e\x26#xe611;\x3c/i\x3e\u8ba2\u5355\u603b\u989d\u9700\u5c0f\u4e8e\x3cspan class\x3d'num-red'\x3e",cx.Money.format(2E5),"\x3c/span\x3e\u5143\uff0c\u8bf7\u4fee\u6539\u8ba2\u5355\u540e\u91cd\u65b0\u6295\u6ce8"].join("")}):cx.castCb(a,{ctype:"create",lotteryId:lotteryId,orderType:r,betMoney:f,buyMoney:e,guarantee:h,typeCnName:typeCnName,issue:currIssue})}});A=setInterval(function(){var a,b,c,e,d=function(a){return("0"+a).slice(-2)};0==time?(cx.Alert({content:['\x3cp class\x3d"jiezhi tal"\x3e\u60a8\u597d\uff0c',realTypeCnName,'\u7b2c\x3cspan class\x3d"num-red"\x3e',currIssue,'\x3c/span\x3e\u671f\u5df2\u622a\u6b62\uff0c\u5f53\u524d\u671f\u662f\u7b2c\x3cspan class\x3d"num-red"\x3e',nextIssue,"\x3c/span\x3e\x3cbr/\x3e\u671f\uff0c\u6295\u6ce8\u65f6\u8bf7\u786e\u8ba4\u9009\u62e9\u7684\u671f\u53f7\x3c/p\x3e"].join(""),confirmCb:function(){clearInterval(A);location.assign([location.origin,location.pathname].join(""))}}),alertLastTime--,0==alertLastTime&&(clearInterval(A),location.assign([location.origin,location.pathname].join("")))):(time--,a=Math.floor(time/86400),b=Math.floor(time%86400/3600),c=Math.floor(time%3600/60),e=Math.floor(time%3600%60),a=0<a?"\u672c\u671f\u6295\u6ce8\u5269\u4f59\uff1a\x3cem\x3e"+d(a)+"\x3c/em\x3e\u5929\x3cem\x3e"+d(b)+"\x3c/em\x3e\u5c0f\u65f6\x3cem\x3e"+d(c)+"\x3c/em\x3e\u5206":"\u672c\u671f\u6295\u6ce8\u5269\u4f59\uff1a\x3cem\x3e"+d(b)+"\x3c/em\x3e\u5c0f\u65f6\x3cem\x3e"+d(c)+"\x3c/em\x3e\u5206\x3cem\x3e"+d(e)+"\x3c/em\x3e\u79d2",$(".count-down1").html(a))},1E3);$(".hmendTime .form-item-txt").html(hmDate.getFullYear()+"-"+padd(hmDate.getMonth()+1)+"-"+padd(hmDate.getDate())+" "+padd(hmDate.getHours())+":"+padd(hmDate.getMinutes())+":"+padd(hmDate.getSeconds()));$(".buy-type-hd").on("click","li",function(){if(1==$(this).index()){r=4;$(this).find(".ptips-bd").hide();var a='\u591a\u4eba\u51fa\u8d44\u8d2d\u4e70\u5f69\u7968\uff0c\u5956\u91d1\u6309\u8d2d\u4e70\u6bd4\u4f8b\u5206\u4eab\x3cspan class\x3d"mod-tips"\x3e\x3ci class\x3d"icon-font bubble-tip" tiptext\x3d"\x3cem\x3e\u5408\u4e70\uff1a\x3c/em\x3e\u9009\u597d\u6295\u6ce8\u53f7\u7801\u540e\uff0c\u7531\u591a\u4eba\u51fa\u8d44\x3cbr\x3e\u8d2d\u4e70\u5f69\u7968\u3002\u4e2d\u5956\u540e\uff0c\u5956\u91d1\u6309\u8d2d\u4e70\u6bd4\u4f8b\x3cbr\x3e\u5206\u4eab\u3002"\x3e\x26#xe613;\x3c/i\x3e'}else r=0,$("#ordertype1").parents("span").find(".ptips-bd").show(),a='\u7531\u8d2d\u4e70\u4eba\u81ea\u884c\u5168\u989d\u8d2d\u4e70\u5f69\u7968\uff0c\u72ec\u4eab\u5956\u91d1\x3cspan class\x3d"mod-tips"\x3e\x3ci class\x3d"icon-font bubble-tip" tiptext\x3d"\x3cem\x3e\u81ea\u8d2d\uff1a\x3c/em\x3e\u9009\u597d\u6295\u6ce8\u53f7\u7801\u540e\uff0c\u7531\u81ea\u5df1\u5168\u989d\x3cbr\x3e\u652f\u4ed8\u8d2d\u5f69\u6b3e\u3002\u4e2d\u5956\u540e\uff0c\u81ea\u5df1\u72ec\u4eab\u5168\u90e8\x3cbr\x3e\u7a0e\u540e\u5956\u91d1\u3002"\x3e\x26#xe613;\x3c/i\x3e';$(".chase-number-notes").html(a);w()});$(".chase-number-notes, .guarantee").on("mouseenter",".bubble-tip",function(){$.bubble({target:this,position:"b",align:"l",content:$(this).attr("tiptext"),width:"auto"})}).on("mouseleave",".bubble-tip",function(){$(".bubble").hide()});w()});function padd(w){return("0"+w).slice(-2)};