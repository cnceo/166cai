//Knew that we ventured on such dangerous seas
//That if we wrought out life 'twas ten to one
//   ----William Shakespeare, Henry IV
$(function(){Array.prototype.reduce||(Array.prototype.reduce=function(a){var b=this.length;if("function"!=typeof a)throw new TypeError;if(0==b&&1==arguments.length)throw new TypeError;var c=0;if(2<=arguments.length)var e=arguments[1];else{do{if(c in this){e=this[c++];break}if(++c>=b)throw new TypeError;}while(1)}for(;c<b;c++)c in this&&(e=a.call(null,e,this[c],c,this));return e});"map"in Array.prototype||(Array.prototype.map=function(a,b){for(var c=Array(this.length),e=0,d=this.length;e<d;e++)e in this&&(c[e]=a.call(b,this[e],e,this));return c});var q=$("#schemeTable"),r=$(".match").map(function(){var a=$(this);return{mid:a.data("mid"),home:a.data("home"),away:a.data("away"),endTime:a.data("endtime")}}).get(),p=0,k,h=function(){var a={},b={};a.add=function(a,e){b[a]=e;return this};a.get=function(a){return b[a]||{}};a.getAll=function(){return b};a.getArray=function(){return $.map(b,function(a){return a})};a.harmonicMean=function(){var a=0;$.each(b,function(b,c){a+=1/c.odd});return p/a};a.avgOptimize=function(){var b=a.harmonicMean(),e,d,f,g,m,l;k=h.getArray();e=k.map(function(a,b){return{index:b,value:a.odd}});e.sort(function(a,b){return a.value-b.value});e=e.map(function(a){return k[a.index]});d=e.map(function(a){return Math.max(Math.round(b/(1*a.odd)),1)});f=d.reduce(function(a,b){return a+b})-p;if(0<f)for(;0<f;){l=!1;g=0;for(m=d.length;g<m;g++)if(1<d[g]){--d[g];f--;if(0===f)break;l=!0}if(!l)break}else if(0>f)for(g=d.length;0<=g&&(d[g-1]+=1,f++,0!==f);g--);$.each(e,function(a,b){b.multi=d[a]});e.sort(function(a,b){return a.index-b.index});k=e;a.alterContent();return this};a.hotOptimize=function(){var b=a.harmonicMean(),e,d,f,g,m,l;k=h.getArray();e=k.map(function(a,b){return{index:b,value:a.odd}});e.sort(function(a,b){return a.value-b.value});e=e.map(function(a){return k[a.index]});d=e.map(function(a){return Math.ceil(p/a.odd)});f=d.reduce(function(a,b){return a+b});if(f>p)if(d=e.map(function(a){return Math.max(Math.round(b/(1*a.odd)),1)}),f=d.reduce(function(a,b){return a+b}),f-=p,0<f)for(;0<f;){l=!1;g=0;for(m=d.length;g<m;g++)if(1<d[g]){--d[g];f--;if(0===f)break;l=!0}if(!l)break}else{if(0>f)for(g=d.length;0<=g&&(d[g-1]+=1,f++,0!==f);g--);}else f=p-f,d[0]+=f;$.each(e,function(a,b){b.multi=d[a]});e.sort(function(a,b){return a.index-b.index});k=e;a.alterContent();return this};a.coldOptimize=function(){var b=a.harmonicMean(),e,d,f,g,m,l;k=h.getArray();e=k.map(function(a,b){return{index:b,value:a.odd}});e.sort(function(a,b){return a.value-b.value});e=e.map(function(a){return k[a.index]});d=e.map(function(a){return Math.ceil(p/a.odd)});f=d.reduce(function(a,b){return a+b});if(f>p)if(d=e.map(function(a){return Math.max(Math.round(b/(1*a.odd)),1)}),f=d.reduce(function(a,b){return a+b}),f-=p,0<f)for(;0<f;){l=!1;g=0;for(m=d.length;g<m;g++)if(1<d[g]){--d[g];f--;if(0===f)break;l=!0}if(!l)break}else{if(0>f)for(g=d.length;0<=g&&(d[g-1]+=1,f++,0!==f);g--);}else f=p-f,d[d.length-1]+=f;$.each(e,function(a,b){b.multi=d[a]});e.sort(function(a,b){return a.index-b.index});k=e;a.alterContent();return this};a.zeroOptimize=function(){var b;k=h.getArray();b=k.map(function(a,b){return{index:b,value:a.odd}});b.sort(function(a,b){return a.value-b.value});b=b.map(function(a){return k[a.index]});$.each(b,function(a,b){b.multi=0});b.sort(function(a,b){return a.index-b.index});k=b;a.alterContent();return this};a.alterContent=function(){q.children().each(function(){var a=$(this),b=a.data("index"),b=h.get(b),d=((2*b.odd).toFixed(2)*b.multi).toFixed(2),f=n.getBetMoney();a.find(".multi").val(b.multi);a.find(".each-prize").text(d).toggleClass("main-color-s",d>=f)});return this};a.adjustStandard=function(a){$.each(h.getArray(),function(b,c){c.multi=Math.max(1,Math.round(a/(2*c.odd)))});return this};return a}(),n=function(){var a={},b,c=0,e=0,d=0,f=0;a.renderBet=function(){var c=h.getArray();b=2*$.map(c,function(a){return a.multi}).reduce(function(a,b){return a+b});a.setBetMoney(b);$("#bet-money").html(b);$("#min-money").html((2*$.map(c,function(a){return a.multi*a.odd}).reduce(function(a,b){return a<b?a:b})).toFixed(2));$("#max-money").html((2*$.map(c,function(a){return a.multi*a.odd}).reduce(function(a,b){return a+b})).toFixed(2))};a.getBetMoney=function(){var a=h.getArray();return b=2*$.map(a,function(a){return a.multi}).reduce(function(a,b){return a+b})};a.setBetMoney=function(a){b=a};a.hemaiPop=function(){function g(){$(".buyMoney").val(c).parents(".form-item-con").find("span em:first").html(l).parents(".form-item-con").find("u").show().find("em").html(0<b?Math.floor(100*c/b):0);$(".guarantee").parents(".form-item-con").find("span em:first").html(b-c);$(".buy_txt").html("\x3cem class\x3d'main-color-s'\x3e"+(c+d)+"\x3c/em\x3e \u5143 \x3cspan\x3e\uff08\u8ba4\u8d2d"+c+"\u5143+\u4fdd\u5e95"+d+"\u5143\uff09\x3c/span\x3e\x3c/span\x3e")}function m(){$(".guarantee").val(d).parents(".form-item-con").find("span em:last").html(0<b?Math.floor(100*d/b):0);$(".buy_txt").html("\x3cem class\x3d'main-color-s'\x3e"+(c+d)+"\x3c/em\x3e \u5143 \x3cspan\x3e\uff08\u8ba4\u8d2d"+c+"\u5143+\u4fdd\u5e95"+d+"\u5143\uff09\x3c/span\x3e\x3c/span\x3e")}var l=5;b=a.getBetMoney();var h=new Date(Date.parse(endTime.replace(/-/g,"/"))-6E4*hmahead);$(".pop-pay").find(".jzdt").html(h.getFullYear()+"-"+padd(h.getMonth()+1)+"-"+padd(h.getDate())+" "+padd(h.getHours())+":"+padd(h.getMinutes())+":"+padd(h.getSeconds()));$(".pop-pay").find(".betMoney").html(b);c=Math.ceil(b*l/100);g();m();$(".pop-pay").on("click",".commission li",function(){$(this).parents(".commission").find("li").removeClass("cur");$(this).addClass("cur");e=$(this).data("val");l=5>=e?5:e;buyMoneyTmp=Math.ceil(b*l/100);c=buyMoneyTmp>c?buyMoneyTmp:c;if($(".guaranteeAll").attr("checked")||d>b-c)d=b-c,$(".guaranteeAll").attr("checked","checked"),m();g()});$(".pop-pay").on("blur",".buyMoney",function(){var a=Math.ceil(b*l/100);c=isNaN(parseInt($(this).val(),10))?0:parseInt($(this).val(),10);c=c<a?a:c>b?b:c;if($(".guaranteeAll").attr("checked")||d>b-c)d=b-c,$(".guaranteeAll").attr("checked","checked"),m();g()});$(".pop-pay").on("blur",".guarantee",function(){d=isNaN(parseInt($(this).val(),10))?0:parseInt($(this).val(),10);$(".guaranteeAll").removeAttr("checked");d>=b-c&&(d=b-c,$(".guaranteeAll").attr("checked","checked"));d=0>d?0:d;m()});$(".pop-pay").find(".guaranteeAll").on("click",function(){d=b-c;m()});$(".pop-pay").find("input[name\x3dbmsz]").click(function(){f=$(this).val()});$(".pop-pay").find(".submit").click(function(b){$(this).addClass("needTigger");if($.cookie("name_ie"))if($(this).hasClass("not-bind"))cx.PopCom.hide($(".pop-pay")),cx.PopAjax.bind();else{b=a.getCastOptions2();if(0>=b.betTnum)return void new cx.Alert({content:"\u574f\u5566\uff0c\u60a8\u7adf\u7136\u4e00\u6ce8\u65b9\u6848\u90fd\u6ca1\u9009~"});b.isToken=1;cx.castCb(b,{ctype:"create",lotteryId:42,orderType:4,betMoney:b.money,buyMoney:b.buyMoney,guarantee:b.guaranteeAmount,typeCnName:typeHmName})}else cx.PopCom.hide($(".pop-pay")),a.notLogin($(this),b)})};a.getCastOptions=function(){var a=h.getArray(),b=0;return{ctype:"create",buyPlatform:0,codes:$.map(a,function(a){if(0<a.multi)return b++,["HH",a.str,a.multi,a.parlay].join("|")}).join(";"),lid:lotteryId,money:2*$.map(a,function(a){return a.multi}).reduce(function(a,b){return a+b}),multi:1,issue:cx.Datetime.getToday(),playType:7,betTnum:b,isChase:0,orderType:0,endTime:endTime,codecc:$.map(r,function(a){return a.mid}).join(" "),isToken:1}};a.getCastOptions2=function(){var a=h.getArray(),b=0;return{ctype:"create",buyPlatform:0,codes:$.map(a,function(a){if(0<a.multi)return b++,["HH",a.str,a.multi,a.parlay].join("|")}).join(";"),lid:lotteryId,money:2*$.map(a,function(a){return a.multi}).reduce(function(a,b){return a+b}),multi:1,issue:cx.Datetime.getToday(),playType:7,betTnum:b,isChase:0,orderType:4,codecc:$.map(r,function(a){return a.mid}).join(" "),endTime:hmendTime,buyMoney:c,commissionRate:e,guaranteeAmount:d,openStatus:f,openEndtime:openEndtime,ForecastBonusv:$("#min-money").html()+"|"+$("#max-money").html()}};a.notLogin=function(a,b){if(a.hasClass("not-login")||!$.cookie("name_ie"))cx.PopAjax.login(b.target.className.match("hemai")?"":1),b.stopImmediatePropagation();b.preventDefault()};return a}();q.children().each(function(){var a=$(this),b=a.data("index"),c=a.data("odd"),e=a.data("str"),d=a.data("parlay"),a=a.data("multi");h.add(b,{index:b,odd:c,str:e,parlay:d,multi:a});p+=a});$("body").on("focus","#plan",function(){$(this).closest(".bonus-plan-label").find(".mod-tips-t").hide()}).on("keyup","#plan",function(){var a=$(this).val();2*$.map(h.getArray(),function(a){return a.multi}).reduce(function(a,c){return a+c})!=a&&($("#avgOptimize").removeClass("selected"),$("#hotOptimize").removeClass("selected"),$("#coldOptimize").removeClass("selected"),h.zeroOptimize(),q.children().each(function(){$(this).find(".multi").val(0)}),$("#bet-money").html(0),$("#min-money").html("0.00"),$("#max-money").html("0.00"))}).on("blur","#plan",function(){var a=$(this),b=a.val();/^\d+$/.test(b)||(b=MIN_BET_MONEY);b%2&&b++;b<MIN_BET_MONEY&&(b=MIN_BET_MONEY,a.closest(".bonus-plan-label").find(".mod-tips-t").html("\u4e3a\u8fbe\u5230\u8f83\u597d\u7684\u4f18\u5316\u6548\u679c\uff0c\u6295\u6ce8\u91d1\x3cbr\x3e\u989d\u81f3\u5c11\u4e3a\u539f\u65b9\u6848\u91d1\u989d\u76842\u500d \x3cb\x3e\x3c/b\x3e\x3cs\x3e\x3c/s\x3e").show());2E5<b&&(b=2E5,a.closest(".bonus-plan-label").find(".mod-tips-t").html(['\x3ci class\x3d"icon-font"\x3e\x26#xe600;\x3c/i\x3e\u8bf7\u8f93\u5165',cx.Money.format(2E5),"\u5143\u4ee5\u4e0b\u65b9\u6848\u91d1\u989d\u8fdb\u884c\u4f18\u5316"].join("")).show());p=b/2;a.val(b)}).on("click","#avgOptimize",function(){var a=$(this);a.hasClass("disabled")||(h.avgOptimize(),n.renderBet(),a.addClass("selected").siblings(".selected").removeClass("selected"))}).on("click","#hotOptimize",function(){var a=$(this);a.hasClass("disabled")||(h.hotOptimize(),n.renderBet(),a.addClass("selected").siblings(".selected").removeClass("selected"))}).on("click","#coldOptimize",function(){var a=$(this);a.hasClass("disabled")||(h.coldOptimize(),n.renderBet(),a.addClass("selected").siblings(".selected").removeClass("selected"))}).on("click",".stdPlus",function(){var a=$(this).prev().children(".multi"),b=a.val();b++;b=Math.min(b,1E6);a.val(b)}).on("click",".stdMinus",function(){var a=$(this).next().children(".multi"),b=a.val();b--;b=Math.max(0,b);a.val(b)}).on("blur",".stdMulti",function(){var a=$(this),b=a.val();(b=parseInt(b,10))?/^\d+$/.test(b)||(b=0):b=0;b=Math.min(1E6,b);a.val(b)}).on("keyup",".stdMulti",function(a){var b=$(this),c=b.val(),c=parseInt(c,10);48<=a.which&&57>=a.which||8==a.which||96<=a.which&&105>=a.which?""!=c&&(c||(c=0),c=Math.min(1E6,c),b.val(c)):/^\d+$/.test(c)||b.val(0)}).on("click","#stdConfirm",function(){var a=$(this).closest(".edit-box").find(".stdMulti").val();h.adjustStandard(a);h.alterContent();n.renderBet()}).on("click",".eachPlus",function(){var a=$(this),b=a.closest(".bet-list-item").data("index"),b=h.get(b),c=b.multi;c++;c=Math.min(c,1E5);a.prev().children(".multi").val(c);b.multi=c;h.alterContent();n.renderBet()}).on("click",".eachMinus",function(){var a=$(this),b=a.closest(".bet-list-item").data("index"),b=h.get(b),c=b.multi;c--;c=Math.max(0,c);a.prev().children(".multi").val(c);b.multi=c;h.alterContent();n.renderBet()}).on("blur",".eachMulti",function(){var a=$(this),b=a.closest(".bet-list-item").data("index"),b=h.get(b),c,e=$.trim(a.val());(c=parseInt(e,10))?/^\d+$/.test(e)||(c=0):c=0;c=Math.min(1E5,c);a.val(c);b.multi=c;h.alterContent();n.renderBet()}).on("keyup",".eachMulti",function(a){var b=$(this),c=b.closest(".bet-list-item").data("index"),c=h.get(c),e,d=$.trim(b.val());e=parseInt(d,10);if(36>=a.which||41<=a.which)48<=a.which&&57>=a.which||8==a.which||96<=a.which&&105>=a.which?""==d?e=0:(e||(e=0),e=Math.min(1E5,e),b.val(e)):/^\d+$/.test(d)||(e=0,b.val(e)),c.multi=e,h.alterContent(),n.renderBet()}).on("click",".submitOpt",function(a){var b=$(this);if(b.hasClass("not-login")||!$.cookie("name_ie"))return n.notLogin(b,a),!1;if(b.hasClass("not-bind"))return!1;if(!$("#avgOptimize").hasClass("selected")&&!$("#hotOptimize").hasClass("selected")&&!$("#coldOptimize").hasClass("selected"))return void new cx.Alert({content:"\u8ba1\u5212\u91d1\u989d\u53d8\u66f4, \u8bf7\u91cd\u65b0\u9009\u62e9\u4f18\u5316\u65b9\u6848\uff01"});k=h.getArray();k.sort(function(a,b){return a.index-b.index});a=n.getCastOptions();if(2E5<a.money)return void new cx.Alert({content:["\x3ci class\x3d'icon-font'\x3e\x26#xe611;\x3c/i\x3e\u8ba2\u5355\u603b\u989d\u9700\u5c0f\u4e8e\x3cspan class\x3d'num-red'\x3e",cx.Money.format(2E5),"\x3c/span\x3e\u5143\uff0c\u8bf7\u4fee\u6539\u8ba2\u5355\u540e\u91cd\u65b0\u6295\u6ce8"].join("")});if(0>=a.betTnum)return void new cx.Alert({content:"\u574f\u5566\uff0c\u60a8\u7adf\u7136\u4e00\u6ce8\u65b9\u6848\u90fd\u6ca1\u9009~"});var b=new Date,c=endTime.split(" "),e=c[0].split("-"),d=e[0],f=e[1]-1,e=e[2],c=c[1].split(":");if(new Date(d,f,e,c[0],c[1],c[2])<=b)return void new cx.Confirm({btns:[{type:"cancel",href:"javascript:;",txt:"\u53d6\u6d88"},{type:"confirm",href:"javascript:;",txt:"\u91cd\u65b0\u9009\u62e9\u65b9\u6848"}],wrapper:{begin:'\x3cdiv class\x3d"pub-pop pop-confirm pop-new pop-w-min" style\x3d"width:380px; "\x3e',end:"\x3c/div\x3e"},inlineBtn:!0,content:['\x3cdiv class\x3d"pop-txt text-indent"\x3e\x3ci class\x3d"icon-font"\x3e\x26#xe61f;\x3c/i\x3e\u6295\u6ce8\u5217\u8868\u4e2d\u3010\x3ca href\x3d"javascript:;"\x3e ',r[0].home,"VS",r[0].away,"\x3c/a\x3e\u3011\u5df2\u622a\u6b62\u6216\u73a9\u6cd5\u6682\u65f6\u4e0d\u53ef\u6295\u6ce8\x3c/div\x3e"].join(""),confirmCb:function(){var a=$(".match").map(function(){var a=$(this),b=a.data("mid"),a=a.find(".wager");return[b,a.map(function(){var a=$(this),b=a.data("option");return[a.data("type"),b].join("/")}).get().join(",")].join("\x3d")}).get().join(";");$("#stakeStr").val(a);$("#stakeForm").submit()}});cx.castCb(a,{ctype:"create",lotteryId:42,orderType:0,betMoney:a.money,typeCnName:typeCnName})}).on("click",".btn-hemai",function(a){data=n.getCastOptions2();if(0>=data.betTnum)return void new cx.Alert({content:"\u574f\u5566\uff0c\u60a8\u7adf\u7136\u4e00\u6ce8\u65b9\u6848\u90fd\u6ca1\u9009~"});$(this).addClass("needTigger");if($(this).hasClass("not-login")||!$.cookie("name_ie"))return n.notLogin($(this),a),!1;if($(this).hasClass("not-bind"))return!1;if(!$("#avgOptimize").hasClass("selected")&&!$("#hotOptimize").hasClass("selected")&&!$("#coldOptimize").hasClass("selected"))return void new cx.Alert({content:"\u8ba1\u5212\u91d1\u989d\u53d8\u66f4, \u8bf7\u91cd\u65b0\u9009\u62e9\u4f18\u5316\u65b9\u6848\uff01"});$.ajax({type:"post",url:"/pop/hemai",data:{version:version},success:function(a){$("body").prepend(a);cx.PopCom.show(".pop-pay");cx.PopCom.close(".pop-pay",{cb:function(){openStatus=guarantee=commission=buyMoney=0}});n.hemaiPop();$(".pop-pay").find(".bet_info").hide()}})})});function padd(q){return("0"+q).slice(-2)};