(function($){var playTypes=["SPF","RQSPF","CBF","JQS","BQC"];var playNames={SPF:"\u80DC\u5E73\u8D1F",RQSPF:"\u8BA9\u7403\u80DC\u5E73\u8D1F",CBF:"\u731C\u6BD4\u5206",JQS:"\u8FDB\u7403\u6570",BQC:"\u534A\u5168\u573A"};var playOptions={SPF:[3,1,0],RQSPF:[3,1,0],JQS:[0,1,2,3,4,5,6,7],CBF:["1:0","2:0","2:1","3:0","3:1","3:2","4:0","4:1","4:2","5:0","5:1","5:2","9:0","0:0","1:1","2:2","3:3","9:9","0:1","0:2","1:2","0:3","1:3","2:3","0:4","1:4","2:4","0:5","1:5","2:5","0:9"],BQC:["3:3","3:1","3:0","1:3","1:1","1:0","0:3","0:1","0:0"]};var playOptionNames={SPF:{3:"\u4E3B\u80DC",1:"\u5E73",0:"\u5BA2\u80DC"},RQSPF:{3:"\u4E3B\u80DC\u3010\u8BA9\u3011",1:"\u5E73\u3010\u8BA9\u3011",0:"\u5BA2\u80DC\u3010\u8BA9\u3011"},JQS:{7:"7+"},CBF:{"9:0":"\u80DC\u5176\u4ED6","9:9":"\u5E73\u5176\u4ED6","0:9":"\u8D1F\u5176\u4ED6"},BQC:{"3-3":"\u80DC-\u80DC","3-1":"\u80DC-\u5E73","3-0":"\u80DC-\u8D1F","1-3":"\u5E73-\u80DC","1-1":"\u5E73-\u5E73","1-0":"\u5E73-\u8D1F","0-3":"\u8D1F-\u80DC","0-1":"\u8D1F-\u5E73","0-0":"\u8D1F-\u8D1F"}};function parseTicket(tickets,ticketInfo){tickets=tickets.split(";");var cast={};for(var i=0;i<tickets.length;++i){var ticket=tickets[i];var parts=ticket.split("|");var playType=parts[0];var codes=parts[1];var passWays=parts[2];$(codes.split(",")).each(function(k,v){var playType,matchId,options;var detail=v.split("=");if(v.indexOf(">")==-1){playType=parts[0];matchId=detail[0]}else{playType=detail[0].split(">")[0];matchId=detail[0].split(">")[1]}options=detail[1].split(",");if(!(matchId in cast)){cast[matchId]={play:0,let:0}}if(!(playType in cast[matchId])){cast[matchId][playType]=[];cast[matchId].play+=1}var pattern=/([\d\-\:]*)(?:\{(.*)\})?\(?(\d*\.?\d*)?\)?@(\d*)?/;$(options).each(function(ks,vs){$(vs.split("/")).each(function(k,v){var matches=v.match(pattern);if(matches){var pl;var plArr=[];var pks;var pksArr=[];if(ticketInfo!==null&&ticketInfo!==undefined){$.each(ticketInfo[matchId][playType],function(pk,tickinfo){if(pk!=="-")pksArr.push(pk);$.each(tickinfo,function(fa,tinfo){if(fa.toString().indexOf(matches[1])>-1){$.each(tinfo,function(key,ti){if($.inArray(ti,pksArr)==-1)plArr.push(ti)})}})});pl=plArr.join("&");pks=pksArr.join("&")}else{pl="";pks="-"}var option={cast:matches[1],odd:pl,multi:parseInt(matches[4],10)};if(playType=="RQSPF"){cast[matchId].let=pks}if($.inArray(option,cast[matchId][playType])==-1){cast[matchId][playType].push(option)}}})})})}return cast}function parseCastPassway(ticket){var parts=ticket.split("|");var passWays=parts[2];return passWays}function renderResult(casts,matches,ticketInfo){var tpl="";var cast;var tmp=[];for(var matchId in casts){cast=casts[matchId];cast.matchId=matchId;tmp.push(cast)}tmp.sort(function(a,b){a=parseInt(a.matchId,10);b=parseInt(b.matchId,10);return a>b?1:a<b?-1:0});var c;for(var i=0;i<tmp.length;++i){c=tmp[i];tpl+=renderMatch(c.matchId,c,matches[c.matchId],ticketInfo)}return tpl}function renderMatch(matchId,cast,matchInfo,ticketInfo){var ticketData=[];var tpl="<tr>";var rowspan=cast.play;if(matchId.length<11){matchId="20"+matchId}var score="-";if(matchInfo.score){score=matchInfo.score+"<br/>("+matchInfo.halfScore+")"}if(matchInfo.mStatus==1){score="\u573A\u6B21\u53D6\u6D88"}tpl+='<td rowspan="'+rowspan+'">'+getMatchId(matchId).join(" ")+"</td>";tpl+='<td rowspan="'+rowspan+'">'+_formatDateTime(matchInfo.dt)+"</td>";tpl+='<td rowspan="'+rowspan+'"><div><span class="tar" style="float:left; width: 50%">'+matchInfo.home+'&nbsp;&nbsp;</span><span class="tal" style="float:left; width: 50%">&nbsp;&nbsp;'+matchInfo.away+"</span></div></td>";tpl+='<td rowspan="'+rowspan+'"><p>'+score+"</p></td>";var playCount=0;$(playTypes).each(function(k,playType){if(playType in cast){if(playCount>0){tpl+="<tr>"}var playName=playNames[playType];if(playType=="RQSPF"){playName=playName+"("+cast.let+")"}tpl+="<td>"+playName+"</td>";tpl+="<td>"+_renderAward(playType,cast.let,matchInfo)+"</td>";if(ticketInfo!==null&&ticketInfo!==undefined){ticketData=ticketInfo[matchId][playType]}tpl+="<td>"+_renderOptions(playType,cast[playType],cast.let,matchInfo,ticketData)+"</td>";tpl+="<td>"+_renderMoney(cast[playType])+"</td>";tpl+="</tr>";playCount+=1}});return tpl}function _renderAward(playType,let,matchInfo){var tpl="<p>";var castName="-";if(matchInfo.score){var result=_getCastOption(playType,matchInfo.score,matchInfo.halfScore,let);castName=_getCastName(playType,result)}tpl+=castName+"</p>";return tpl}function _renderVs(matchInfo){if(matchInfo){return"<p>"+matchInfo.home+"</p><p>VS</p><p>"+matchInfo.away+"</p>"}else{return""}}function _renderLet(playType,let){if(playType==="RQSPF"){if(let!==null&&let!==undefined){return let}}return"-"}function _getCastOption(playType,score,halfScore,let){var homeScore=parseInt(score.split(":")[0],10);var awayScore=parseInt(score.split(":")[1],10);var let=parseInt(let,10);var result=null;if(playType=="SPF"){result=_parseScore(homeScore,awayScore,0)}else if(playType=="RQSPF"){result=_parseScore(homeScore,awayScore,let)}else if(playType=="JQS"){result=homeScore+awayScore;result=result>7?7:result}else if(playType=="CBF"){result=homeScore+":"+awayScore;if($.inArray(result,playOptions[playType])==-1){if(homeScore>awayScore){result="9:0"}else if(homeScore===awayScore){result="9:9"}else{result="0:9"}}}else if(playType=="BQC"){var halfHome=parseInt(halfScore.split(":")[0],10);var halfAway=parseInt(halfScore.split(":")[1],10);var halfResult=_parseScore(halfHome,halfAway,0);var fullResult=_parseScore(homeScore,awayScore,0);result=halfResult+"-"+fullResult}return result}function _getCastName(playType,cast){if(cast in playOptionNames[playType]){return playOptionNames[playType][cast]}else{return cast}}function _renderOptions(playType,options,let,matchInfo,ticketData){var tpl="";var castName="";var casts=[];tpl+='<div class="jc-inTable-pd">';$(options).each(function(k,option){if($.inArray(option.cast,casts)>-1){return}if(matchInfo.score){var isRight=false;var getRight=0;var rightOdds=[];if(playType=="RQSPF"){var letArr=let.split("&");for(var i=0;i<letArr.length;i++){isRight=_compareResult(playType,matchInfo.score,letArr[i],option,matchInfo.halfScore);if(isRight){if(ticketData!==null&&ticketData!==undefined&&ticketData[letArr[i]][option.cast]!==undefined){for(var j=0;j<ticketData[letArr[i]][option.cast].length;j++){rightOdds.push(ticketData[letArr[i]][option.cast][j])}getRight=getRight+1}}}}else{isRight=_compareResult(playType,matchInfo.score,let,option,matchInfo.halfScore);if(isRight){getRight=1}}}castName=_getCastName(playType,option.cast);if(getRight){tpl+='<p><span class="main-color-s">'+castName+"</span>"}else{tpl+="<p>"+castName}if(option.odd){if(playType=="RQSPF"){tpl+="(";var optionOdds=option.odd.split("&");for(var x=0;x<optionOdds.length;x++){if($.inArray(optionOdds[x],rightOdds)>-1){tpl+='<em class="main-color-s">'+optionOdds[x]+"</em>";if(x<optionOdds.length-1){tpl+="&"}}else{tpl+=optionOdds[x];if(x<optionOdds.length-1){tpl+="&"}}}tpl+=")"}else{if(getRight>0){tpl+='<em class="main-color-s">('+option.odd+")</em>"}else{tpl+="("+option.odd+")"}}}tpl+="</p>";casts.push(option.cast)});tpl+="</div>";return tpl}function _renderMoney(options){var tpl='<div class="jc-inTable-pd">';var money=0;$(options).each(function(k,option){money=parseFloat(option.multi*2);tpl+="<p>"+formatNum(money)+"\u5143</p>"});tpl+="</div>";return tpl}function formatNum(num){return(num.toFixed(2)+"").replace(/\d{1,3}(?=(\d{3})+(\.\d*)?$)/g,"$&,")}function getMatchId(dateStr){var year=dateStr.substr(0,4);var month=parseInt(dateStr.substr(4,2),10);var day=dateStr.substr(6,2);var date=new Date(year,month-1,day);var dayId=dateStr.substr(8,3);return["\u5468"+"\u65E5\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D".charAt(date.getDay()),dayId]}function parseOrderCode(code){var options=code.split("|")[1].split(",");var cast={};$(options).each(function(k,v){var matchId=v.split("=")[0];var options=v.split("=")[1].split("/");if(!(matchId in cast)){cast[matchId]=options}});return cast}function _compareResult(playType,score,let,option,halfScore){var let=parseInt(let,10);var result=_getCastOption(playType,score,halfScore,let);return result==option.cast}function _parseScore(homeScore,awayScore,let){homeScore+=let;if(homeScore>awayScore){return 3}else if(homeScore===awayScore){return 1}else{return 0}}function _paddNum(num){num+="";return num.replace(/^(\d)$/,"0$1")}function _formatDateTime(dateTime){var dt=new Date(dateTime);return _paddNum(dt.getMonth()+1)+"-"+_paddNum(dt.getDate())+" "+_paddNum(dt.getHours())+":"+_paddNum(dt.getMinutes())}window.jcDetail=function(){var me={};me.renderOrderCast=function(cast,awards,ticketInfo){var result=parseTicket(cast,ticketInfo);var matches={};var passWay=cast.split("|")[2].replace(/\*/g,"\u4E32");$(awards).each(function(key,award){if(award&&"mid"in award){matches[award.mid]={home:award.home,away:award.awary,score:award.score,halfScore:award.scoreHalf,dt:award.dt,mStatus:award.mStatus}}});$(".pass-way").append(passWay);$(".match-award").append(renderResult(result,matches,ticketInfo))};me.getMatchId=function(dateStr){return getMatchId(dateStr)};return me}()})($);
